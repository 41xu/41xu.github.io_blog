---
title:	python中装饰与闭包
tags:	python 装饰器
---

> 呵，不会写装饰器就别说自己会写python好了。

### 闭包

**闭包的定义**：在外函数中定义了一个内函数，内函数里运用了外函数的临时变量，并且外函数的返回值是内函数的引用，这样就构成了一个闭包。

来一段代码示例
```
def outer(a):
	b=10
	print("This is outer")
	def inner():
		print("This is inner")
		print(a+b)
	return inner()

demo=outer(5)
//输出:
//This is outer
//This is inner
//15
```
定义给的很明确，实例也很明确，闭包就是这么回事就完事了！

### 装饰器

> 啊..这个真是完全没听过也没用过呢..

**装饰器的定义**：装饰器是一种设计模式，它可以在不修改目标函数代码的前提下，在目标函数执行前后增加一些额外功能。在python中对装饰器提供了额外的支持。//这是上课的PPT上的定义

概念看着非常抽象..那我们通俗点说：

- **为什么有装饰器**：有的时候你不能改变/没有权限改变某个函数，这个时候加上个装饰器，我们就可以随随便便的用它啦！如果不用装饰器的话，即使我们按照差不多的方式对这个函数进行改造，但会可能出现这个函数被调用了两次甚至多次的问题，很浪费，所以装饰器就方便了很多！

- **怎么理解装饰器**：我们都知道函数定义的时候需要参数，装饰器你可以看成是一个函数--这个函数的参数是我们要操作的目标函数如func(),之后把这个目标函数作为参数传进装饰器里就可以完成对目标函数的相关操作了。

一般我们的修饰器都是这样写的：
```
def deco(f):
	def wrapper():
		f() # 这里就是对形参进行的一系列操作
		return f # 返回这个传进来的参数也就是未来的函数
	return wrapper

# 想用到经过装饰器改造完的函数，我们要@艾特一下装饰器
# 实际上这个东西叫 语法糖
@deco
func()
```
解释：

首先定义了deco函数，就是这个装饰器的外包装。函数都要有返回值，修饰器是要对函数进行改造的，因此就要返回改造好的对象wrapper。**注意，这里不可以return wrapper()返回一个函数，而应该返回一个对象。**返回的时候也不可以返回目标函数return f，（返回目标函数的话..不就可以理解成经过一个包装之后原函数变了吗..这是不可以的）

由于不能直接返回f，所以我们要借助一个对象（你可以理解成以前写交换函数的时候的temp用来临时储存一下..）这个对象就是这里的wrapper。在wrapper里我们可以对deco传进来的参数进行一系列操作，之后返回改造完的形参，这样的话就可以外壳里传进原函数，原函数这个实参就可以被包装然后吐出来了（觉得我这里说的可能不太对）反正你不return f()的话可能会出现None的问题..

然后再用装饰器之前@艾特一下他 就可以用了

以上就是个人的通俗的对装饰器这个东西的理解，这里有一些写代码的时候遇到的值得注意的问题：
- deco里只是要传进一个要对他进行改造的目标函数，也就是一个参数，这个参数不一定要和被改造的原函数同名，比如说这里的deco(f)可以deco(func)也可以。这里放进了什么参数对应的在wrapper中进行操作时就要用一样名字的，也就是形参实参的问题。
- 由于我们装饰器外壳最后返回的是wrapper，因此wrapper()应该和原函数func()结构一致，func有怎样的参数wrapper就应该有怎样的参数。
- wrapper中return f可以理解成完成了对函数的改造返回的新的值

---

> 可能上面讲的还是很迷..那接下来就让我们用一段实际代码感受一下好了

```
import time

l = [{"Tom": "123"}, {"Jerry": "456"}]


def login(func):
    def wrapper():
        while 1:
            loginnum = input("请输入你的用户名：")
            password = input("请输入密码：")
            if {loginnum: password} in l:

                break
            else:
                if loginnum in [list(c.keys())[0] for c in l]:
                    print("哦哟你的密码不正确！请重新输入！")

                else:
                    print("你还未注册，我们将自动为您完成注册！")
                    l.append({loginnum:password})
                    time.sleep(0.5)
                    print("注册完成，请重新登录吧！")

        return func()
    return wrapper


@login
def index():
    return "登录成功，首页展示！"


print(index())
```
这个代码是这周的机器学习（python）课留的作业..要求是这样的
![这是要求](/img/9.6图.png)

写代码的时候遇到的问题就是..wrapper函数里没有在最后return func()，在print(index())的时候就遇到了，代码进入了if判断的部分，但是没有正常输出，而是打印出来了None.
这里很感谢**家展学长**大晚上的帮我看代码以及帮我讲了装饰器，还找了博客给我看～肥肠感谢了！鞠躬！

> 以上就是..我对装饰器的个人很不专业的理解..如有问题请评论区指出啦～感谢阅读！欢迎您在下方留言！

